---
// import { SignIn, SignedIn } from "@clerk/clerk-react";
import SignedIn from "@components/auth/SignedIn.astro";
import { db, Courses, Lessons, eq } from "astro:db";

import UserButton from "@components/auth/UserButton.astro";
import MainLayout from "@components/layouts/MainLayout.astro";

import App from "@components/layouts/Iniciar-sesion";
import SignedOut from "@components/auth/SignedOut.astro";
import LessonsList from "@components/root-program/LessonsList.astro";

// const invitationkey = Astro.url.searchParams.get("__clerk_ticket");
// console.log("invitationkey", invitationkey);

export async function getStaticPaths() {
    const courses = await db.select().from(Courses);
    return courses.map((course) => ({
        params: { CourseSlug: course.slug },
        props: { course },
    }));
}


const { course } = Astro.props;
console.log("course", course);
// const [course] = await db
//     .select()
//     .from(Courses)
//     .where(eq(Courses.slug, CourseSlug));
const lessons = await db
    .select()
    .from(Lessons)
    .where(eq(Lessons.courseId, course.id));

---

<MainLayout
    description={"sitio de melina batalla, comunicadora visual"}
    title={"Melina Batalla"}
>
    <div class="h-full min-h-screen flex justify-center items-center bg-white">
        <SignedOut>
            <App client:only />
        </SignedOut>
        <SignedIn>
            <div>
                <UserButton />
            </div>
            <div class="flex justify-between">
                <div class="w-80 hidden md:flex" id="sideBar">
                    <LessonsList lessons={lessons} />
                </div>
                <div
                    class="xxl:my-8 flex flex-col gap-10 mx-auto px-0 text-left max-w-screen-sm"
                >
                    <h1
                        class="text-6xl text-left md:text-6xl leading-[3rem] tracking-tight text-negro font-bold"
                    >
                        {course.name}
                    </h1>
                    <span>{course.description}</span>
                    <LessonsList lessons={lessons} />
                </div>
            </div>
        </SignedIn>
    </div>
</MainLayout>
